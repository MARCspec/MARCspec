<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Carsten Klee (ZDB)" />
  <meta name="date" content="2015-03-31" />
  <title>MARCspec - A common MARC record path language</title>
   <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <style type="text/css">
  body { font-family: sans-serif; }
  a { text-decoration: none }
  a:hover { text-decoration: underline }
  h1 { font: 170% sans-serif }
  h1.title { font-size: 200%; font-weight: bold; }
  h2 { font: 140% sans-serif }
  h3 { font: 120% sans-serif }
  dt { font-weight: bold; }
  h1, h2, h3, h1 a, h2 a, h3 a { color: #005A9C; }
  table { border-collapse: collapse; }
  td { border: 1px solid #999; padding: 3px }
  dl p { margin-top: 0; }
  dt { margin-top: 0.8em; }
  dd { margin-left: 1.5em; }
  ol { margin-bottom: 1em; }
  table + p { margin-top: 1em; }
  </style>
  <link rel="stylesheet" href="code-box.css" />
</head>
<body>
<a href="https://github.com/MARCspec/MARCspec/"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub"></a>
<header>
<h1 class="title">MARCspec - A common MARC record path language</h1>
<h3 class="author">Carsten Klee (ZDB)</h3>
<h4 class="date">2015-03-31 (version 0.12draftrev8)</h4>
</header>

<h1>Table of Contents</h1>
<nav id="TOC">
<ul>
<li><a href="#introduction"><span class="toc-section-number">1</span> Introduction</a><ul>
<li><a href="#status-of-this-document"><span class="toc-section-number">1.1</span> Status of this document</a></li>
<li><a href="#terminology"><span class="toc-section-number">1.2</span> Terminology</a></li>
<li><a href="#what-is-a-marcspec"><span class="toc-section-number">1.3</span> What is a MARCspec?</a></li>
</ul></li>
<li><a href="#limitations-of-marcspec-as-string"><span class="toc-section-number">2</span> Limitations of MARCspec as string</a><ul>
<li><a href="#basic-references"><span class="toc-section-number">2.1</span> Basic references</a></li>
<li><a href="#form-of-marcspec-as-string"><span class="toc-section-number">2.2</span> Form of MARCspec as string</a><ul>
<li><a href="#general-form"><span class="toc-section-number">2.2.1</span> General form</a></li>
<li><a href="#reference-to-field-data"><span class="toc-section-number">2.2.2</span> Reference to field data</a></li>
<li><a href="#reference-to-substring"><span class="toc-section-number">2.2.3</span> Reference to substring</a></li>
<li><a href="#reference-to-data-content"><span class="toc-section-number">2.2.4</span> Reference to data content</a></li>
<li><a href="#reference-to-repetitions"><span class="toc-section-number">2.2.5</span> Reference to repetitions</a></li>
<li><a href="#reference-to-contextualized-data"><span class="toc-section-number">2.2.6</span> Reference to contextualized data</a><ul>
<li><a href="#indicators"><span class="toc-section-number">2.2.6.1</span> Indicators</a></li>
<li><a href="#subspecs"><span class="toc-section-number">2.2.6.2</span> SubSpecs</a></li>
</ul></li>
</ul></li>
<li><a href="#marcspec-interpretation"><span class="toc-section-number">2.3</span> MARCspec interpretation</a><ul>
<li><a href="#character-position-or-range-interpretation"><span class="toc-section-number">2.3.1</span> Character position or range interpretation</a></li>
<li><a href="#subspec-interpretation"><span class="toc-section-number">2.3.2</span> SubSpec interpretation</a></li>
<li><a href="#subspec-validation"><span class="toc-section-number">2.3.3</span> SubSpec validation</a></li>
<li><a href="#subterm-validation-table"><span class="toc-section-number">2.3.4</span> SubTerm validation table</a></li>
</ul></li>
</ul></li>
<li><a href="#definition-of-marc-related-terms-used-in-this-spec"><span class="toc-section-number">3</span> Definition of MARC related terms used in this spec</a></li>
<li><a href="#examples"><span class="toc-section-number">4</span> Examples</a><ul>
<li><a href="#reference-to-field-data-examples"><span class="toc-section-number">4.1</span> Reference to field data examples</a></li>
<li><a href="#reference-to-field-data-with-repetitions-examples"><span class="toc-section-number">4.2</span> Reference to field data with repetitions examples</a></li>
<li><a href="#reference-to-substring-examples"><span class="toc-section-number">4.3</span> Reference to substring examples</a></li>
<li><a href="#reference-to-data-content-examples"><span class="toc-section-number">4.4</span> Reference to data content examples</a></li>
<li><a href="#reference-to-data-content-with-repetitions-examples"><span class="toc-section-number">4.5</span> Reference to data content with repetitions examples</a></li>
<li><a href="#reference-to-contextualized-data-with-indicators-examples"><span class="toc-section-number">4.6</span> Reference to contextualized data with indicators examples</a></li>
<li><a href="#reference-to-contextualized-data-with-subspecs-examples"><span class="toc-section-number">4.7</span> Reference to contextualized data with subSpecs examples</a><ul>
<li><a href="#checking-dependencies-via-string-comparison"><span class="toc-section-number">4.7.1</span> Checking dependencies via string comparison</a></li>
<li><a href="#checking-existence-of-fields"><span class="toc-section-number">4.7.2</span> Checking existence of fields</a></li>
<li><a href="#abbreviation-of-fieldspec-or-subfieldspec"><span class="toc-section-number">4.7.3</span> Abbreviation of fieldSpec or subfieldSpec</a></li>
</ul></li>
</ul></li>
<li><a href="#references"><span class="toc-section-number">5</span> References</a><ul>
<li><a href="#normative-references"><span class="toc-section-number">5.1</span> Normative references</a></li>
<li><a href="#informative-references"><span class="toc-section-number">5.2</span> Informative references</a></li>
<li><a href="#revision-history"><span class="toc-section-number">5.3</span> Revision history</a></li>
</ul></li>
</ul>
</nav>
<section class="level1" id="introduction">
<h1><a href="#TOC"><span class="header-section-number">1</span> Introduction</a></h1>
<p>Since it became a common task to map <a href="http://www.loc.gov/marc/">MARC</a> data to arbitrary formats, these mappings are normally based on a set of definitions of MARC fields and subfields called <em>MARC field specification</em> or short <em>MARC spec</em>.</p>
<p>There are already implementations of <em>MARC specs</em> in tools like <a href="https://github.com/billdueber/marcspec">marcspec</a>, <a href="http://librecat.org/">catmandu</a>, <a href="https://code.google.com/p/solrmarc/">solrmarc</a> and <a href="https://github.com/cKlee/easyM2R">easyM2R</a>. Each of them using a different flavour of <em>MARC spec</em>. This document is an approach to normalize such field specifications.</p>
<p>The hereby described specification <strong>MARCspec</strong> can help to build reusable MARCspec parsers and validators and facilitates the exchange of mapping definitions.</p>
<section class="level2" id="status-of-this-document">
<a id="Status of this document"></a><h2><a href="#TOC"><span class="header-section-number">1.1</span> Status of this document</a></h2>
<p>The current version of this proposal is a preliminary draft for open discussion. <a href="https://github.com/MARCspec/MARCspec/issues">Feedback</a> is welcome!</p>
</section>
<section class="level2" id="terminology">
<a id="Terminology"></a><h2><a href="#TOC"><span class="header-section-number">1.2</span> Terminology</a></h2>
<p>The keywords <q>MUST</q>, <q>MUST NOT</q>, <q>REQUIRED</q>, <q>SHALL</q>, <q>SHALL NOT</q>, <q>SHOULD</q>, <q>SHOULD NOT</q>, <q>RECOMMENDED</q>, <q>MAY</q>, and <q>OPTIONAL</q> in this document are to be interpreted as described in <a href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a>.</p>
<p>See also <a href="#definition-of-marc-related-terms-used-in-this-spec">Definition of MARC related terms used in this spec</a>.</p>
</section>
<section class="level2" id="what-is-a-marcspec">
<a id="What is a MARCspec?"></a><h2><a href="#TOC"><span class="header-section-number">1.3</span> What is a MARCspec?</a></h2>
<p>Machine-Readable Cataloguing (MARC) is a document based key-value exchange format for bibliographic and other library related data. A MARC record consists of three main sections: the <strong>leader</strong>, the <strong>directory</strong>, and the <strong>variable fields</strong> with the <strong>data content</strong>. There are two kinds of (variable) fields: (variable) <strong>control fields</strong> and (variable) <strong>data fields</strong>. The term <strong>fixed field</strong> stands for fields whose length does not vary like the leader and some of the <em>control fields</em>. The <strong>field content</strong> in the the <em>fixed fields</em> can be accessed through its <strong>character position or range</strong>. Only <em>data fields</em> are divided into <em>subfields</em>. <em>Subfields</em> can also be contextualized through indicators. There is an indicator 1 and an indicator 2 for all data fields, both are optional.</p>
<p>A <strong>MARCspec</strong> is a reference to field data of a MARC record and is very much like XPath for XML. With MARCspec one can reference data on different levels of a MARC record defined through the <em>fields</em>, <em>character positions</em>, <em>subfields</em> and <em>indicators</em>.</p>
<p>The <em>data</em> of the MARC record being referenced may be represented through a <em>set of data</em>, having zero or more <em>data elements</em>. MARCspec does neither define the form of this referenced <em>set of data</em>, nor the encoding of the referenced <em>data content</em>.</p>
</section>
</section>
<section class="level1" id="limitations-of-marcspec-as-string">
<h1><a href="#TOC"><span class="header-section-number">2</span> Limitations of MARCspec as string</a></h1>
<p>A MARCspec might not fulfil all requirements of definition for a reference to the desired set of data like XPath does for XML. This is because of the nearly unlimited number of options accessing data in a MARC record, especially when it comes to delimiters based on cataloging rules. Thus a MARCspec has to concentrate on the basic references and let all other data processing to subsequent data processing functions of tools having implemented MARCspec.</p>
<p>To enable support for other <a href="http://en.wikipedia.org/wiki/ISO_2709">ISO 2709</a> applications MARCspecs syntax does not distinguish between types of fields like in the <a href="http://www.loc.gov/marc/">MARC</a> record structure. A valid MARCspec might violate the MARC record structure. It is led to the MARCspec aware tools weather to check for MARC record structure violation or not.</p>
<section class="level2" id="basic-references">
<a id="Basic references"></a><h2><a href="#TOC"><span class="header-section-number">2.1</span> Basic references</a></h2>
<p>A MARCspec allows the following basic references:</p>
<ul>
<li>Reference to <em>record data</em> (except data from the record directory)</li>
<li>Reference to <em>field data</em></li>
<li>Reference to <em>data content</em> of subfields</li>
<li>Reference to substrings of <em>data content</em> of fixed fields and subfields</li>
</ul>
<p>References a MARCspec does allow are:</p>
<ul>
<li>Reference to single <em>designators</em>, field tags or subfield codes</li>
<li>Reference to a position index of a specific field, subfield or character</li>
<li>Reference to data in related records</li>
<li>Reference to <em>data elements</em> (entries) in the MARC record directory</li>
</ul>
</section>
<section class="level2" id="form-of-marcspec-as-string">
<a id="Form of MARCspec as string"></a><h2><a href="#TOC"><span class="header-section-number">2.2</span> Form of MARCspec as string</a></h2>
<p><strong>This section is normative.</strong></p>
<p>The <strong>Augmented BNF for Syntax Specifications: ABNF</strong> <a href="http://tools.ietf.org/html/rfc5234">RFC 5234</a> is used to define the form of the MARCspec as string.</p>
<p>The whole ABNF for MARCspec shows as follows</p>
<pre><code>alphaupper       = %x41-5A
                    ; A-Z
alphalower       = %x61-7A
                   ; a-z
positiveDigit    = %x31-39
                    ;  &quot;1&quot; / &quot;2&quot; / &quot;3&quot; / &quot;4&quot; / &quot;5&quot; / &quot;6&quot; / &quot;7&quot; / &quot;8&quot; / &quot;9&quot;
positiveInteger  = &quot;0&quot; / positiveDigit [1*DIGIT]
indicator        = alphalower / DIGIT
indicator1       = indicator
indicator2       = indicator
indicators       = &quot;_&quot; (indicator1 / &quot;_&quot;) [indicator2 / &quot;_&quot;]
fieldTag         = 3(alphalower / DIGIT / &quot;.&quot;) / 3(alphaupper / DIGIT / &quot;.&quot;)
position         = positiveInteger / &quot;#&quot;
range            = position &quot;-&quot; position
positionOrRange  = range / position
characterSpec    = &quot;/&quot; positionOrRange
subfieldChar     = %x21-3F / %x5B-7B / %x7D-7E
                    ; ! &quot; # $ % &amp; &#39; ( ) * + , - . / 0-9 : ; &lt; = &gt; ? [ \ ] ^ _ \` a-z { } ~
subfieldTag      = &quot;$&quot; subfieldChar
subfieldTagRange = &quot;$&quot; ( (alphalower &quot;-&quot; alphalower) / (DIGIT &quot;-&quot; DIGIT) )
                    ; [a-z]-[a-z] / [0-9]-[0-9]
index            = &quot;[&quot; positionOrRange &quot;]&quot;
fixedField       = fieldTag [index] characterSpec
variableField    = fieldTag [index] indicators
fieldSpec        = fixedField / variableField
subfieldSpec     = (subfieldTag / subfieldTagRange) [index] [characterSpec]
comparisonString = &quot;\&quot; *VCHAR
operator         = &quot;=&quot; / &quot;!=&quot; / &quot;~&quot; / &quot;!~&quot; / &quot;!&quot; / &quot;?&quot;
                    ; equal / unequal / includes / not includes / not exists / exists
subTerm          = fieldSpec / subfieldSpec / comparisonString
subTermSet       = [ [subTerm] operator ] subTerm
subSpec          = &quot;{&quot; subTermSet *( &quot;|&quot; subTermSet ) &quot;}&quot;
MARCspec         = (variableField *subSpec *(subfieldSpec *subSpec)) / fixedField *subSpec</code></pre>
<section class="level3" id="general-form">
<h3><a href="#TOC"><span class="header-section-number">2.2.1</span> General form</a></h3>
<p>Every <strong>MARCspec</strong> consists of a <em>fixed field</em> spec or <em>variable field</em> spec. <em>Variable fields</em> followed optionally by one or more <em>subfieldSpecs</em>. Both <em>fieldSpec</em> and <em>subfieldSpec</em> can be contextualized through <em>subSpecs</em> (see section [SubSpecs]).</p>
<pre><code>fieldSpec = fixedField / variableField
MARCspec  = (variableField *subSpec *(subfieldSpec *subSpec)) / fixedField *subSpec</code></pre>
</section>
<section class="level3" id="reference-to-field-data">
<h3><a href="#TOC"><span class="header-section-number">2.2.2</span> Reference to field data</a></h3>
<p>A <strong>fieldSpec</strong> is a reference to <em>field data</em> of a field. It consists of the three character <em>field tag</em>, followed optionally</p>
<ul>
<li>by an <em>index</em> (see section [Reference to repetitions]) and</li>
<li>by an <em>characterSpec</em> (for <em>fixed fields</em>) (see section [Reference to substring]) or</li>
<li>by <em>indicators</em> (for <em>variable fields</em>) (see section [Reference to data content]).</li>
</ul>
<p>The <strong>field tag</strong> may consist of ASCII numeric characters (decimal integers 0-9) and/or ASCII alphabetic characters (uppercase or lowercase, but not both) or the character <code>.</code>. The character <code>.</code> is interpreted as a wildcard. E.g. <q>3..</q> is then a reference to the <em>data elements</em> in all <em>fields</em> beginning with <q>3</q>.</p>
<p>The special <em>field tag</em> <code>LDR</code> is the <em>field tag</em> for the <em>leader</em>.</p>
<pre><code>alphaupper    = %x41-5A ; A-Z
alphalower    = %x61-7A; a-z
fieldTag      = 3(alphalower / DIGIT / &quot;.&quot;) / 3(alphaupper / DIGIT / &quot;.&quot;)
fixedField    = fieldTag [index] characterSpec
variableField = fieldTag [index] indicators</code></pre>
</section>
<section class="level3" id="reference-to-substring">
<h3><a href="#TOC"><span class="header-section-number">2.2.3</span> Reference to substring</a></h3>
<p>A <strong>characterSpec</strong> is a reference to a character or a range of characters within a <em>field</em> or <em>subfield</em>. It consists of a <em>position or range</em> prefixed with the character <code>/</code>.</p>
<pre><code>characterSpec = &quot;/&quot; positionOrRange</code></pre>
<p>A <strong>position or range</strong> is either a <em>postion</em> or a <em>range</em>.</p>
<p>The <strong>postion</strong> is either a <em>positive integer</em> or the character <code>#</code> as a symbol for the last character of the referenced <em>data content</em>.</p>
<p>The <strong>range</strong> consists of two <em>positions</em> concatenated with the character <code>-</code>.</p>
<pre><code>positiveDigit   = %x31-39
                    ;  &quot;1&quot; / &quot;2&quot; / &quot;3&quot; / &quot;4&quot; / &quot;5&quot; / &quot;6&quot; / &quot;7&quot; / &quot;8&quot; / &quot;9&quot;
positiveInteger = &quot;0&quot; / positiveDigit [1*DIGIT]
position        = positiveInteger / &quot;#&quot;
range           = position &quot;-&quot; position
positionOrRange = range / position</code></pre>
<p>Interpretation of a <em>range</em> differs through the position of the special <em>position</em> character `<code>#</code> as a symbol for the last character of the referenced <em>data content</em> (see <a href="#marcspec-interpretation">MARCspec interpretation</a> for implicit rules).</p>
</section>
<section class="level3" id="reference-to-data-content">
<h3><a href="#TOC"><span class="header-section-number">2.2.4</span> Reference to data content</a></h3>
<p>The <strong>subfieldSpec</strong> is a reference to the <em>data content</em> (value) of a <em>subfield</em>. It either consists of a <em>subfieldTag</em> or a <em>subfieldTagRange</em> followed optionally by an <em>index</em> and a <em>characterSpec</em>.</p>
<pre><code>subfieldSpec = (subfieldTag / subfieldTagRange) [index] [characterSpec]</code></pre>
<p>A <strong>subfieldTag</strong> is a <em>subfieldChar</em> prefixed by the character <code>$</code>.</p>
<p>A <strong>subfieldTagRange</strong> is prefixed by the character <code>$</code> and restricted to either two alphabetic or two numeric characters both concatenated with the character <code>-</code>.</p>
<p>A <strong>subfieldChar</strong> is a lowercase alphabetic, a numeric character or a special character.</p>
<pre><code>subfieldChar     = %x21-3F / %x5B-7B / %x7D-7E
subfieldTag      = &quot;$&quot; subfieldChar
subfieldTagRange = &quot;$&quot; ( (%x61-7A &quot;-&quot; %x61-7A) / (%x30-39 &quot;-&quot; %x30-39) )</code></pre>
</section>
<section class="level3" id="reference-to-repetitions">
<h3><a href="#TOC"><span class="header-section-number">2.2.5</span> Reference to repetitions</a></h3>
<p>For repeatable <em>fields</em> and <em>subfields</em> each repetition can be referenced by its <strong>index</strong>. An index is a <em>position or range</em> enclosed with the characters <code>[</code> and <code>]</code>. The first repetition of a <em>field</em> or a <em>subfield</em> is always referenced with the index <code>[0]</code>. The last repetition of a <em>field</em> or a <em>subfield</em> is referenced with the index <code>[#]</code>.</p>
<pre><code>index = &quot;[&quot; positionOrRange &quot;]&quot;</code></pre>
</section>
<section class="level3" id="reference-to-contextualized-data">
<h3><a href="#TOC"><span class="header-section-number">2.2.6</span> Reference to contextualized data</a></h3>
<section class="level4" id="indicators">
<h4><a href="#TOC"><span class="header-section-number">2.2.6.1</span> Indicators</a></h4>
<p><strong>Indicators</strong> are prefixed by the character <code>_</code>. There are two indicators: <strong>indicator 1</strong> and <strong>indicator 2</strong>. Both are optional and either represented through a lowercase alphabetic or a numeric character. If <em>indicator 1</em> is not specified, it MUST be replaced by the character <code>_</code>. If <em>indicator 2</em> is not specified it might be replaced by the character <code>_</code> or left blank.</p>
<pre><code>indicator  = alphalower / DIGIT
indicator1 = indicator
indicator2 = indicator
indicators = &quot;_&quot; (indicator1 / &quot;_&quot;) [indicator2 / &quot;_&quot;]</code></pre>
</section>
<section class="level4" id="subspecs">
<h4><a href="#TOC"><span class="header-section-number">2.2.6.2</span> SubSpecs</a></h4>
<p>With a <strong>subSpec</strong> the preceding <em>fieldSpec</em> or <em>subfieldSpec</em> gets contextualized. Every <em>subSpec</em> MUST be validated either <strong>true</strong> or <strong>false</strong>. Is a <em>subSpec</em> <em>true</em>, the preceding spec is used to reference data. Is a subSpec <em>false</em>, the preceding spec doesn’t get used to reference data.</p>
<p>A <em>subSpec</em> is enclosed with the characters <code>{</code> and <code>}</code>. A <em>subSpec</em> consists of one or more sets of <em>subTerms</em> (the <strong>left hand subTerm</strong> and the <strong>right hand subTerm</strong>) and an <em>operator</em>. This combination of <em>subTerms</em> and an <em>operator</em> can be <em>chained</em> through the character <code>|</code> (<strong>OR</strong>) within a <em>subSpec</em>. Multiple <em>subSpecs</em> can also be <em>repeated</em> one after another (<strong>AND</strong>).</p>
<pre><code>subTerm    = fieldSpec / subfieldSpec / comparisonString
subTermSet = [ [subTerm] operator ] subTerm
subSpec    = &quot;{&quot; subTermSet *( &quot;|&quot; subTermSet ) &quot;}&quot;</code></pre>
<p>The <strong>operator</strong> is one of</p>
<ul>
<li><code>=</code> (as a symbol for <q>equal</q>),</li>
<li><code>!=</code> (as a symbol for <q>unequal</q>),</li>
<li><code>~</code> (as a symbol for <q>includes</q>),</li>
<li><code>!~</code> (as a symbol for <q>not includes</q>)</li>
<li><code>!</code> (as a symbol for <q>not exists</q>) or</li>
<li><code>?</code> (as a symbol for <q>exists</q>).</li>
</ul>
<pre><code>operator = &quot;=&quot; / &quot;!=&quot; / &quot;~&quot; / &quot;!~&quot; / &quot;!&quot; / &quot;?&quot;</code></pre>
<p>A <strong>subTerm</strong> is one of</p>
<ul>
<li><em>fieldSpec</em></li>
<li><em>subfieldSpec</em></li>
<li><em>comparisonString</em>.</li>
</ul>
<p>It is possible to <strong>abbreviate</strong> a contextualized <em>fieldSpec</em> by only using</p>
<ul>
<li>an <em>index</em> and/or</li>
<li>a <em>characterSpec</em> and/or</li>
<li><em>indicators</em></li>
</ul>
<p>as a <em>subTerm</em> (see [Abbreviation of fieldSpec or subfieldSpec] for examples).</p>
<p>It is possible to <strong>abbreviate</strong> a contextualized <em>subfieldSpec</em> by only using</p>
<ul>
<li>an <em>index</em> and/or</li>
<li>a <em>characterSpec</em></li>
</ul>
<p>as a <em>subTerm</em> (see [Abbreviation of fieldSpec or subfieldSpec] for examples).</p>
<p>By omitting the <em>left hand subTerm</em>, this implicitly makes the preceding spec the <em>left hand subTerm</em> (see <a href="#marcspec-interpretation">MARCspec interpretation</a> for implicit rules and [Reference to contextualized data examples] for examples). For <em>subSpecs</em> with omitted <em>left hand subTerm</em> the <em>operator</em> can also be omitted. Omitting the <em>operator</em> this implies the use of the <em>operator</em> <code>?</code> (exists).</p>
<p>A <strong>comparisonString</strong> can be every combination of ASCII characters prefixed by the <code>\</code> character. For unambiguousness in a <em>comparisonString</em> the following characters MUST be escaped by the character <code>\</code>:</p>
<ul>
<li><code>$</code></li>
<li><code>{</code></li>
<li><code>}</code></li>
<li><code>!</code></li>
<li><code>=</code></li>
<li><code>~</code></li>
<li><code>?</code></li>
<li><code>|</code></li>
</ul>
<p>In a <em>comparisonString</em> a whitespace MUST be encoded as the character combination <code>\s</code>.</p>
<pre><code>comparisonString = &quot;\&quot; *VCHAR</code></pre>
</section>
</section>
</section>
<section class="level2" id="marcspec-interpretation">
<a id="MARCspec interpretation"></a><h2><a href="#TOC"><span class="header-section-number">2.3</span> MARCspec interpretation</a></h2>
<p>Because of the limited expressivity of the MARCspec there must be some kind of implicit interpretation.</p>
<ol type="1">
<li>A MARCspec without <em>subfield tags</em> or <em>position or range</em> is a reference to all <em>data elements</em> of the field.</li>
<li>For repeatable <em>fields</em> the <em>field tag</em> without an <em>index</em> MUST be interpreted as a reference to the data in all repetitions.</li>
<li>For repeatable <em>subfields</em> the <em>subfield tag</em> without an <em>index</em> MUST be interpreted as a reference to the data content in all repetitions.</li>
<li>Omitted <em>indicators</em> in a MARCspec are interpreted as wildcards for variable field indicators in the MARC record.</li>
</ol>
<section class="level3" id="character-position-or-range-interpretation">
<h3><a href="#TOC"><span class="header-section-number">2.3.1</span> Character position or range interpretation</a></h3>
<ol type="1">
<li>The <em>postion</em> character <code>#</code> is always a reference to the last character in the <em>data content</em>.</li>
<li>For character range, if the <em>positive integer</em> used for the character starting position is greater than the <em>positive integer</em> used for the character ending position, the current spec MUST NOT reference any data.</li>
<li>For character range, if the character <code>#</code> is used for the character starting position, the character indices MUST be interpreted backwards (like character ending position <code>0</code> for the last character, <code>1</code> for the last but one character, <code>2</code> for the last but two characters etc.).</li>
</ol>
</section>
<section class="level3" id="subspec-interpretation">
<h3><a href="#TOC"><span class="header-section-number">2.3.2</span> SubSpec interpretation</a></h3>
<ol type="1">
<li>For <strong>chained sets of subTerms</strong>, if one <em>subTermSet</em> gets validated as true, the preceding spec gets referenced (OR) as log as all other <em>repeated SubSpecs</em> are validated as true.</li>
<li>For <strong>repeatable subSpecs</strong>, if one <em>subSpec</em> gets validated as false, the preceding spec doesn’t get referenced (AND).</li>
<li>For abbreviated <em>fieldSpec</em> or <em>subfieldSpec</em> as , the <em>subTerm</em>, the last explicitly given <em>fieldTag</em> is the current <em>fieldTag</em>.</li>
<li>As a shortcut, the left hand <em>subTerm</em> might be omitted. This implicitly makes the last explicitly given <em>fieldTag</em> plus the last explicitly given <em>characterSpec</em> or <em>subfieldTagSpec</em> the current (left hand) <em>subTerm</em>.</li>
<li>If the left hand <em>subTerm</em> is omitted, as a shortcut for the operator <code>=</code>, the operator can also be omitted.</li>
</ol>
</section>
<section class="level3" id="subspec-validation">
<h3><a href="#TOC"><span class="header-section-number">2.3.3</span> SubSpec validation</a></h3>
<p><em>SubSpecs</em> get validated by the following rules:</p>
<p>A <em>subSpec</em> is <strong>true</strong>, if</p>
<ul>
<li>with the operator <code>=</code> one of the referenced values of the <em>left hand subTerm</em> is equal to one of the referenced values of the <em>right hand subTerm</em>.</li>
<li>with the operator <code>!=</code> none of the referenced values of the <em>left hand subTerm</em> is equal to one of the referenced values of the <em>right hand subTerm</em>.</li>
<li>with the operator <code>~</code> one of the referenced values of the <em>left hand subTerm</em> includes one of the referenced values of the <em>right hand subTerm</em>.</li>
<li>with the operator <code>!~</code> none of the referenced values of the <em>left hand subTerm</em> includes one of the referenced values of the <em>right hand subTerm</em>.</li>
<li>with the operator <code>?</code> by the <em>right hand subTerm</em> referenced data exists.</li>
<li>with the operator <code>!</code> by the <em>right hand subTerm</em> no referenced data exists.</li>
<li>one of the <em>chained subTermSets</em> is validated as true (OR) and all other <em>repeated subSpecs</em> are validated as true.</li>
<li>all of the <em>repeated subSpecs</em> are validated as true (AND).</li>
</ul>
<p>A <em>subSpec</em> is <strong>false</strong>, if</p>
<ul>
<li>the left hand <em>subTerm</em> does not reference any data (null).</li>
<li>with the operator <code>=</code> none of the referenced values of the <em>left hand subTerm</em> is equal to one of the referenced values of the <em>right hand subTerm</em>.</li>
<li>with the operator <code>!=</code> one of the referenced values of the <em>left hand subTerm</em> is equal to one of the referenced values of the <em>right hand subTerm</em>.</li>
<li>with the operator <code>~</code> none of the referenced values of the <em>left hand subTerm</em> includes one of the referenced values of the <em>right hand subTerm</em>.</li>
<li>with the operator <code>!~</code> one of the referenced values of the <em>left hand subTerm</em> includes one of the referenced values of the <em>right hand subTerm</em>.</li>
<li>with the operator <code>?</code> by the <em>right hand subTerm</em> no referenced data exists (null).</li>
<li>with the operator <code>!</code> by the <em>right hand subTerm</em> referenced data exists.</li>
<li>all of the <em>chained subTermSets</em> are validated as false (OR).</li>
<li>one of the <em>repeated subSpecs</em> is validated as false (AND).</li>
</ul>
</section>
<section class="level3" id="subterm-validation-table">
<h3><a href="#TOC"><span class="header-section-number">2.3.4</span> SubTerm validation table</a></h3>
<p>| operator | right is null | left equals right | right is subpart of left | left is subpart of right | other | |:———:|:————-:|:—————–:|:————————:|:————————:|:—–:| |<strong>=</strong> |false |true |false |false |false | |<strong>!=</strong> |true |false |true |true |true | |<strong>~</strong> |false |true |true |false |false | |<strong>!~</strong> |true |false |false |true |true | |<strong>?</strong> |false |true |true |true |true | |<strong>!</strong> |true |false |false |false |false |</p>
</section>
</section>
</section>
<section class="level1" id="definition-of-marc-related-terms-used-in-this-spec">
<h1><a href="#TOC"><span class="header-section-number">3</span> Definition of MARC related terms used in this spec</a></h1>
<p>MARCspec does not redefine terms already used by the <a href="http://www.loc.gov/marc/ndmso.html">Network Development and MARC Standards Office</a>. MARCspec lists the definition of core terms taken from the <a href="http://www.loc.gov/marc/specifications/specrecstruc.html">RECORD STRUCTURE</a> document and adds some for clarification purposes.</p>
<p>| term | definition | |——————————-|————–| |<strong>content designation</strong> |The codes and conventions established explicitly by MARC 21 to identify and further characterize the <em>data elements</em> within a record and to support the manipulation of that data.| |<strong>content of field</strong> |see <em>field content</em>| |<strong>control field</strong> |A <em>variable field</em> containing information useful or required for the processing of the record. Control fields are assigned <em>tags</em> beginning with two zeroes. Control fields with fixed length data elements are restricted to ASCII graphics.| |<strong>data content</strong> |see <em>data element value</em>| |<strong>data element</strong> |A defined unit of information| |<strong>data element identifier</strong> |A one-character code used to identify individual <em>data elements</em> within a <em>variable field</em>. The <em>data element</em> may be any ASCII lowercase alphabetic, numeric, or graphic symbol except blank.| |<strong>data element value</strong> |The value of a <em>data element</em> in a <em>data field</em>.| |<strong>data field</strong> |A <em>variable field</em> containing bibliographic or other data. Data fields are assigned <em>tags</em> beginning with characters other than two zeroes. Data fields contain data in any MARC 21 character set unless a field-specific restriction applies.| |<strong>data in field</strong> |see <em>field content</em>| |<strong>delimiter</strong> |ASCII control character 1F(hex) (represented graphically in MARC 21 documentation as ASCII control character 1F (hex) or $), which is combined with a <em>data element identifier</em> to make up the <em>subfield code</em> which precedes each individual <em>data element</em> within a variable field. The ASCII name for the delimiter is unit separator (US).| |<strong>field</strong> |A defined character string that may contain one or more <em>data elements</em>.| |<strong>field content</strong> |All <em>data elements</em> in a field without <em>indicators</em>. See also <em>field data</em>.| |<strong>field data</strong> |All <em>data elements</em> in a field including <em>indicators</em>.| |<strong>field index</strong> |see <em>index</em>| |<strong>field tag</strong> |see <em>tag</em>| |<strong>fixed field</strong> |A <em>field</em> whose length does not vary. The term is occasionally used to refer to <em>variable control fields</em>, especially those that contain coded data such as fields 007 or 008.| |<strong>index</strong> |The count of repeatable <em>fields</em> and <em>subfields</em>. The first <em>field</em> in a list of repeatable <em>fields</em> or the first <em>subfield</em> in a list of repeatable <em>subfields</em> has always the index <em>0</em>.| |<strong>indicator</strong> |A <em>data element</em> associated with a <em>data field</em> that supplies additional information about the field. An indicator may be any ASCII lowercase alphabetic, numeric, or blank. Indicators are not used in <em>control fields</em>.| |<strong>leader</strong> |A <em>fixed field</em> that occurs at the beginning of each record and provides information for the processing of the record.| |<strong>set of data</strong> |A set of <em>data elements</em> referenced by a MARCspec.| |<strong>subfield</strong> |A <em>data element</em> including its <em>subfield code</em>. It’s identified by a <em>data element identifier</em> within a <em>variable field</em>.| |<strong>subfield code</strong> |The two-character combination of a <em>delimiter</em> followed by a <em>data element identifier</em>. Subfield codes are not used in <em>control fields</em>.| |<strong>subfield index</strong> |see <em>index</em>| |<strong>subfield tag</strong> |see <em>data element identifier</em>| |<strong>tag</strong> |A three character string used to identify or label an associated <em>field</em>. The tag may consist of ASCII numeric characters (decimal integers 0-9) and/or ASCII alphabetic characters (uppercase or lowercase, but not both).| |<strong>variable control field</strong> |see <em>control field</em>| |<strong>variable data field</strong> |see <em>data field</em>| |<strong>variable field</strong> |A <em>field</em> whose length is determined for each occurrence by the length of data comprising that occurrence. There are two types of variable fields <em>control fields</em> and <em>data fields</em>.|</p>
</section>
<section class="level1" id="examples">
<h1><a href="#TOC"><span class="header-section-number">4</span> Examples</a></h1>
<section class="level2" id="reference-to-field-data-examples">
<a id="Reference to field data examples"></a><h2><a href="#TOC"><span class="header-section-number">4.1</span> Reference to field data examples</a></h2>
<p>Reference to <em>field data</em> of the <em>leader</em>.</p>
<pre><code>LDR</code></pre>
<p>Reference to all <em>field data</em> of fields having a field tag starting with <em>00</em>.</p>
<pre><code>00.</code></pre>
<p>Reference to all <em>field data</em> of fields having a field tag starting with <em>7</em>.</p>
<pre><code>7..</code></pre>
<p>Reference to <em>data elements</em> of all repetitions of the <q>100</q> field.</p>
<pre><code>100</code></pre>
</section>
<section class="level2" id="reference-to-field-data-with-repetitions-examples">
<a id="Reference to field data with repetitions examples"></a><h2><a href="#TOC"><span class="header-section-number">4.2</span> Reference to field data with repetitions examples</a></h2>
<p>Reference to the first <q>300</q> field.</p>
<pre><code>300[0]</code></pre>
<p>Reference to the second of the <q>300</q> field.</p>
<pre><code>300[1]</code></pre>
<p>Reference to the first, second and third of the <q>300</q> field.</p>
<pre><code>300[0-2]</code></pre>
<p>Reference to all but the first of the <q>300</q> field.</p>
<pre><code>300[1-#]</code></pre>
<p>Reference to the last of the <q>300</q> field.</p>
<pre><code>300[#]</code></pre>
<p>Reference to the last two of the <q>300</q> field.</p>
<pre><code>300[#-1]</code></pre>
</section>
<section class="level2" id="reference-to-substring-examples">
<a id="Reference to substring examples"></a><h2><a href="#TOC"><span class="header-section-number">4.3</span> Reference to substring examples</a></h2>
<p>Reference to substring of <em>field data</em> in the <em>leader</em> from character position 0 to character position 4 (5 characters).</p>
<pre><code>LDR/0-4</code></pre>
<p>Reference to data in the <em>leader</em> at character position 6 (1 character).</p>
<pre><code>LDR/6</code></pre>
<p>Reference to data in the control field 007 at character position 0 (1 character).</p>
<pre><code>007/0</code></pre>
<p>Reference to all data but the first character in the control field <q>007</q>.</p>
<pre><code>007/1-#</code></pre>
<p>Reference to the last character in the control field <q>007</q>.</p>
<pre><code>007/#</code></pre>
<p>Reference to the last two characters of the value of the subfield <q>a</q> of field <q>245</q>.</p>
<pre><code>245$a/#-1</code></pre>
</section>
<section class="level2" id="reference-to-data-content-examples">
<a id="Reference to data content examples"></a><h2><a href="#TOC"><span class="header-section-number">4.4</span> Reference to data content examples</a></h2>
<p>Reference to value of the subfield <q>a</q> of field <q>245</q>.</p>
<pre><code>245$a</code></pre>
<p>Reference to the value of the subfields <q>a</q>, <q>b</q> and <q>c</q> of field <q>245</q>.</p>
<pre><code>245$a$b$c</code></pre>
<p>Same as above, but with the use of a <em>subfield tag range</em>.</p>
<pre><code>245$a-c</code></pre>
<p>Reference to the value of the subfields <q>_</q> and <q>$</q> of field <q>300</q>.</p>
<pre><code>300$_$$</code></pre>
</section>
<section class="level2" id="reference-to-data-content-with-repetitions-examples">
<a id="Reference to data content with repetitions examples"></a><h2><a href="#TOC"><span class="header-section-number">4.5</span> Reference to data content with repetitions examples</a></h2>
<p>Reference to value of the subfield <q>a</q> of the first <q>300</q> field.</p>
<pre><code>300[0]$a</code></pre>
<p>Reference to the value of the first subfield <q>a</q> of the field <q>300</q></p>
<pre><code>300$a[0]</code></pre>
<p>Reference to the value of the last subfield <q>a</q> of the field <q>300</q></p>
<pre><code>300$a[#]</code></pre>
<p>Reference to the value of the last two repetitions of subfield <q>a</q> of the field <q>300</q></p>
<pre><code>300$a[#-1]</code></pre>
</section>
<section class="level2" id="reference-to-contextualized-data-with-indicators-examples">
<a id="Reference to contextualized data with indicators examples"></a><h2><a href="#TOC"><span class="header-section-number">4.6</span> Reference to contextualized data with indicators examples</a></h2>
<p>Reference to <em>data content</em> in the subfield <q>a</q> within the context of <em>indicator 1</em> with the value <q>1</q>.</p>
<pre><code>245_1$a

or

245_1_$a</code></pre>
<p>Reference to the value of the subfield <q>a</q> within the context of <em>indicator 1</em> with the value <q>1</q> and <em>indicator 2</em> with the value <q>0</q>.</p>
<pre><code>245_10$a</code></pre>
<p>Reference to the value of the subfield <q>a</q> within the context of <em>indicator 2</em> with the value <q>0</q>.</p>
<pre><code>245__0$a</code></pre>
</section>
<section class="level2" id="reference-to-contextualized-data-with-subspecs-examples">
<a id="Reference to contextualized data with subSpecs examples"></a><h2><a href="#TOC"><span class="header-section-number">4.7</span> Reference to contextualized data with subSpecs examples</a></h2>
<section class="level3" id="checking-dependencies-via-string-comparison">
<h3><a href="#TOC"><span class="header-section-number">4.7.1</span> Checking dependencies via string comparison</a></h3>
<p>If Leader/06 = t: Books</p>
<p>Reference to character with position <q>18</q> of field <q>008</q>, if character with position <q>06</q> in Leader equals <q>t</q>.</p>
<pre><code>008/18{LDR/6=\t}</code></pre>
<hr>
<p>If Field 007/00 = a and t</p>
<p>Reference to subfield <q>b</q> of field 245, if character with position <q>0</q> of field 007 equals <q>a</q> OR <q>t</q>.</p>
<pre><code>245$b{007/0=\a|007/0=\t}</code></pre>
<hr>
<p>If Leader/06 = a and Leader/07 = a, c, d, or m: Books</p>
<p>Reference to character with position <q>18</q> of field <q>008</q>, if character with position <q>06</q> in Leader equals <q>a</q> AND character with position <q>07</q> in Leader equals <q>a</q>, <q>c</q>, <q>d</q> OR <q>m</q>.</p>
<pre><code>008/18{LDR/6=\a}{LDR/7=\a|LDR/7=\c|LDR/7=\d|LDR/7=\m}</code></pre>
<hr>
<p>Example data:</p>
<p>100 1#<span class="math">6880 − 01</span>aZilbershtain, Yitshak ben David Yosef.<br> 880 1#<span class="math">6100 − 01 / (2 / <em>r</em></span>a, יצחק יוסף בן דוד.</p>
<p>Reference data content of subfield <q>a</q> of field <q>880</q>, if data content of subfield <q>6</q> of field <q>100</q> includes the string <q>-01</q> (characters with index range 3-5 of field <q>800</q>) and the string <q>880</q>.</p>
<pre><code>880$a{100_1$6~$6/3-5}{100_1$6~\880}</code></pre>
<hr>
</section>
<section class="level3" id="checking-existence-of-fields">
<h3><a href="#TOC"><span class="header-section-number">4.7.2</span> Checking existence of fields</a></h3>
<p>Reference data content of subfield <q>c</q> of field <q>020</q>, if subfield <q>a</q> of field <q>020</q> exists.</p>
<pre><code>020$c{$a}

or

020$c{?$a}</code></pre>
<hr>
<p>Reference data content of subfield <q>z</q> of field <q>020</q>, if subfield <q>a</q> of field <q>020</q> does not exist.</p>
<pre><code>020$z{!$a}</code></pre>
<hr>
</section>
<section class="level3" id="abbreviation-of-fieldspec-or-subfieldspec">
<h3><a href="#TOC"><span class="header-section-number">4.7.3</span> Abbreviation of fieldSpec or subfieldSpec</a></h3>
<p>Reference to data of the first repetition of field <q>800</q>, if data content of subfield <q>a</q> within the context of indicator 2 is <q>1</q> of the preceding fieldSpec includes the comparisonString <q>Poe</q>.</p>
<pre><code>800[0]{__1$a~\Poe}

or

800[0]{800[0]__1$a~\Poe}</code></pre>
<hr>
<p>Reference of data content of subfield <q>a</q> of field <q>245</q>, if last character of the preceding spec equals the comparisonString <q>/</q>.</p>
<pre><code>245$a{/#=\/}

or

245$a{245$a/#=\/}</code></pre>
</section>
</section>
</section>
<section class="level1" id="references">
<h1><a href="#TOC"><span class="header-section-number">5</span> References</a></h1>
<section class="level2" id="normative-references">
<a id="Normative references"></a><h2><a href="#TOC"><span class="header-section-number">5.1</span> Normative references</a></h2>
<ul>
<li><a href="http://www.ietf.org/rfc/rfc2119.txt">RFC 2119</a></li>
<li><a href="http://tools.ietf.org/html/rfc5234">RFC 5234</a></li>
<li><a href="http://en.wikipedia.org/wiki/ISO_2709">ISO 2709</a></li>
</ul>
</section>
<section class="level2" id="informative-references">
<a id="Informative references"></a><h2><a href="#TOC"><span class="header-section-number">5.2</span> Informative references</a></h2>
<ul>
<li><a href="http://www.loc.gov/marc/">MARC</a></li>
<li><a href="http://www.loc.gov/marc/96principl.html">MARC 21 Principles</a></li>
<li><a href="http://www.loc.gov/marc/specifications/specrecstruc.html">RECORD STRUCTURE</a></li>
<li><a href="https://github.com/billdueber/marcspec">marcspec</a></li>
<li><a href="https://code.google.com/p/solrmarc/">solrmarc</a></li>
<li><a href="http://librecat.org/">catmandu</a></li>
<li><a href="https://github.com/cKlee/easyM2R">easyM2R</a></li>
<li><a href="http://www.loc.gov/marc/ndmso.html">Network Development and MARC Standards Office</a></li>
</ul>
</section>
<section class="level2" id="revision-history">
<a id="Revision history"></a><h2><a href="#TOC"><span class="header-section-number">5.3</span> Revision history</a></h2>
<ul>
<li><a href="marc-spec-0910fa4.html"><code>2015-03-31 06:42:07 +0200</code></a>: <a href="https://github.com/MARCspec/MARCspec/commit/0910fa4cea4fc2ed2b062a93407edcabf3b43576">new issues url</a></li>
<li><a href="marc-spec-2b9600f.html"><code>2015-03-13 12:04:41 +0100</code></a>: <a href="https://github.com/MARCspec/MARCspec/commit/2b9600f4f1867598fa6045753ab19fce65f38529">minor: broken link</a></li>
<li><a href="marc-spec-19e3448.html"><code>2014-08-13 11:09:38 +0200</code></a>: <a href="https://github.com/MARCspec/MARCspec/commit/19e3448dc9992215b6f3e388b4310b70d5c23fa0">fieldTag ABNF</a></li>
<li><a href="marc-spec-d671bcc.html"><code>2014-08-01 15:48:03 +0200</code></a>: <a href="https://github.com/MARCspec/MARCspec/commit/d671bcc22e0cb279df431706b5d91677b8c0938a">clearer reference levels</a></li>
<li><a href="marc-spec-e66931e.html"><code>2014-07-28 13:32:20 +0200</code></a>: <a href="https://github.com/MARCspec/MARCspec/commit/e66931eab881b2b31d3ebddc87e861edcc770390">variable and fixed fields</a></li>
</ul>
</section>
</section>
</body>
</html>
